<!-- templates/register.html -->
{% extends "base.html" %} {% block title %}Register | University Bus Tracker{%
endblock %} {% block content %}
<div class="login-container">
  <div class="card">
    <div class="card-body p-4">
      <h2 class="text-center mb-4">Create Account</h2>
      <form method="POST" action="{{ url_for('register') }}">
        {{ form.csrf_token }}
        <div class="mb-4">
          <label class="form-label">Select User Type</label>
          <div class="row g-3">
            <div class="col-4">
              <div
                class="card role-card text-center p-3"
                onclick="selectRole('student')"
              >
                <div class="feature-icon mx-auto">
                  <i class="fas fa-user-graduate"></i>
                </div>
                <div class="mt-2">Student</div>
                <input
                  type="radio"
                  name="role"
                  value="student"
                  class="form-check-input visually-hidden role-radio"
                  id="student"
                />
              </div>
            </div>
            <div class="col-4">
              <div
                class="card role-card text-center p-3"
                onclick="selectRole('driver')"
              >
                <div class="feature-icon mx-auto">
                  <i class="fas fa-id-card"></i>
                </div>
                <div class="mt-2">Driver</div>
                <input
                  type="radio"
                  name="role"
                  value="driver"
                  class="form-check-input visually-hidden role-radio"
                  id="driver"
                />
              </div>
            </div>
            <div class="col-4">
              <div
                class="card role-card text-center p-3"
                onclick="selectRole('admin')"
              >
                <div class="feature-icon mx-auto">
                  <i class="fas fa-user-shield"></i>
                </div>
                <div class="mt-2">Admin</div>
                <input
                  type="radio"
                  name="role"
                  value="admin"
                  class="form-check-input visually-hidden role-radio"
                  id="admin"
                />
              </div>
            </div>
          </div>
        </div>
        <div id="rollNumberField" class="mb-3" style="display: none">
          <label for="roll_number" class="form-label">Roll Number</label>
          <div class="input-group">
            <span class="input-group-text"
              ><i class="fas fa-id-badge"></i
            ></span>
            <input
              type="text"
              class="form-control"
              id="roll_number"
              name="roll_number"
            />
          </div>
        </div>
        <div class="mb-3">
          <label for="username" class="form-label">Username</label>
          {{ form.username(class="form-control") }}
        </div>
        <div class="mb-3">
          <label for="email" class="form-label">Email</label>
          {{ form.email(class="form-control") }}
          <div
            id="emailFeedback"
            class="invalid-feedback"
            style="display: none"
          >
            Please use a valid @srmap.edu.in email address.
          </div>
        </div>
        <div class="mb-3">
          <label for="password" class="form-label">Password</label>
          <div class="input-group">
            {{ form.password(class="form-control", id="password") }}
            <button
              type="button"
              id="togglePassword"
              class="btn btn-outline-secondary"
            >
              <i class="fas fa-eye"></i>
            </button>
          </div>
        </div>
        <div class="mb-3">
          <label for="confirm_password" class="form-label"
            >Confirm Password</label
          >
          <div class="input-group">
            {{ form.confirm_password(class="form-control",
            id="confirm_password") }}
            <button
              type="button"
              id="toggleConfirmPassword"
              class="btn btn-outline-secondary"
            >
              <i class="fas fa-eye"></i>
            </button>
          </div>
        </div>
        <div class="d-grid">
          <button type="submit" class="btn btn-primary btn-lg">Register</button>
        </div>
      </form>
      <div class="text-center mt-4">
        <p>
          Already have an account?
          <a href="{{ url_for('login') }}">Login here</a>
        </p>
      </div>
    </div>
  </div>
</div>
{% block extra_js %}
<script>
  // Role selection function
  function selectRole(role) {
    console.log("Role selected:", role);
    document
      .querySelectorAll(".role-card")
      .forEach((card) => card.classList.remove("active"));
    document.querySelector(`#${role}`).parentElement.classList.add("active");
    document.getElementById(role).checked = true;

    var rollNumberField = document.getElementById("rollNumberField");
    if (role === "student") {
      rollNumberField.style.display = "block";
      document.getElementById("roll_number").required = true;
    } else {
      rollNumberField.style.display = "none";
      document.getElementById("roll_number").required = false;
    }
  }

  // Password visibility toggle function
  function togglePasswordVisibility(inputId, buttonId) {
    console.log(`Toggle clicked for ${inputId}`);
    var input = document.getElementById(inputId);
    var button = document.getElementById(buttonId);
    var icon = button.querySelector("i");

    if (input && button && icon) {
      console.log(`Current type of ${inputId}:`, input.type);
      if (input.type === "password") {
        input.type = "text";
        icon.classList.remove("fa-eye");
        icon.classList.add("fa-eye-slash");
        console.log(`${inputId} is now visible`);
      } else {
        input.type = "password";
        icon.classList.remove("fa-eye-slash");
        icon.classList.add("fa-eye");
        console.log(`${inputId} is now hidden`);
      }
    } else {
      console.error(
        `Missing elements - input: ${input}, button: ${button}, icon: ${icon}`
      );
    }
  }

  // Email validation and event listeners
  window.onload = function () {
    console.log("Page loaded, initializing...");

    // Password toggle
    var togglePassword = document.getElementById("togglePassword");
    if (togglePassword) {
      togglePassword.addEventListener("click", function () {
        togglePasswordVisibility("password", "togglePassword");
      });
      console.log("Password toggle initialized");
    } else {
      console.error("togglePassword not found");
    }

    // Confirm password toggle
    var toggleConfirmPassword = document.getElementById(
      "toggleConfirmPassword"
    );
    if (toggleConfirmPassword) {
      toggleConfirmPassword.addEventListener("click", function () {
        togglePasswordVisibility("confirm_password", "toggleConfirmPassword");
      });
      console.log("Confirm password toggle initialized");
    } else {
      console.error("toggleConfirmPassword not found");
    }

    // Email validation on input and submission
    var emailInput = document.getElementById("email");
    var emailFeedback = document.getElementById("emailFeedback");
    var registerForm = document.querySelector("form");

    if (emailInput && emailFeedback && registerForm) {
      // Real-time validation
      emailInput.addEventListener("input", function () {
        if (!this.value.endsWith("@srmap.edu.in")) {
          this.classList.add("is-invalid");
          emailFeedback.style.display = "block";
        } else {
          this.classList.remove("is-invalid");
          emailFeedback.style.display = "none";
        }
      });

      // Form submission validation
      registerForm.addEventListener("submit", function (event) {
        console.log("Form submitted, validating email:", emailInput.value);
        if (!emailInput.value.endsWith("@srmap.edu.in")) {
          event.preventDefault();
          emailInput.classList.add("is-invalid");
          emailFeedback.style.display = "block";
          console.log("Email validation failed");
        } else {
          emailInput.classList.remove("is-invalid");
          emailFeedback.style.display = "none";
          console.log("Email validation passed");
        }
      });
    } else {
      console.error("Email validation elements not found");
    }
  };
</script>
{% endblock %} {% endblock %}
